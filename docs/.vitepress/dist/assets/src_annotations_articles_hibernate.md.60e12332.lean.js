import{_ as s,v as a,b as n,R as e}from"./chunks/framework.bf5b583c.js";const l="/Java/assets/entite_jpa.56e84d01.png",p="/Java/assets/generic_generator.ca391a85.png",o="/Java/assets/manytoone.bfe85c4e.png",t="/Java/assets/enquete_select.96696115.png",c="/Java/assets/inheritance1.f70d4e5b.png",r="/Java/assets/inheritance2.82020c21.png",i="/Java/assets/inheritance3.52d7c633.png",v=JSON.parse('{"title":"JPA, Hibernate ORM","description":"","frontmatter":{},"headers":[],"relativePath":"src/annotations/articles/hibernate.md","filePath":"src/annotations/articles/hibernate.md","lastUpdated":null}'),y={name:"src/annotations/articles/hibernate.md"},d=e(`<h1 id="jpa-hibernate-orm" tabindex="-1">JPA, Hibernate ORM <a class="header-anchor" href="#jpa-hibernate-orm" aria-label="Permalink to &quot;JPA, Hibernate ORM&quot;">​</a></h1><p>( à utiliser dans les classes métier en important les annotations du package javax.persistence)</p><h2 id="entity" tabindex="-1">@Entity <a class="header-anchor" href="#entity" aria-label="Permalink to &quot;@Entity&quot;">​</a></h2><p>Définit une classe POJO (Plain Old Java Object) persistante</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Theme</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> String</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">nom;</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Theme</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Long id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String nom;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>Chaque objet de type Theme aura une correspondance avec un enregistrement de la table Theme. En oubliant cette annotation sur une classe métier on obtient une exception <code>IllegalArgumentException</code> :Not a managed type: class fr.clelia.fx.enquetes.business.Theme Les entités JPA ont un cycle de vie présenté sur le diagramme suivant :</p><p><img src="`+l+`" alt="entite_jpa"><em>Source: Oracle</em></p><h2 id="id" tabindex="-1">@Id <a class="header-anchor" href="#id" aria-label="Permalink to &quot;@Id&quot;">​</a></h2><p>Précise que l&#39;attribut annoté va donner lieu à une colonne qui sera la clé primaire de la table associée</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Long id;</span></span></code></pre></div><h2 id="table" tabindex="-1">@Table <a class="header-anchor" href="#table" aria-label="Permalink to &quot;@Table&quot;">​</a></h2><p>Définit le nom de la table associée à la classe POJO persistante</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Table</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;utilisateurs&quot;</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Utilisateur</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Table</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;utilisateurs&quot;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Utilisateur</span><span style="color:#24292E;"> {}</span></span></code></pre></div><h2 id="index" tabindex="-1">@Index <a class="header-anchor" href="#index" aria-label="Permalink to &quot;@Index&quot;">​</a></h2><p>Ajoute un index sur la ou les colonnes précisées en paramètre. Cette annotation s’utilise en association avec l’annotation <code>@Table</code></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Table</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;utilisateurs&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">indexes</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> {@</span><span style="color:#F47067;">Index</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">columnList</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;nom&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;idx_nom&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">unique</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">false</span><span style="color:#ADBAC7;">)})</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Utilisateur</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Table</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;utilisateurs&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">indexes</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {@</span><span style="color:#D73A49;">Index</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">columnList</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;nom&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;idx_nom&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">unique</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">)})</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Utilisateur</span><span style="color:#24292E;"> {}</span></span></code></pre></div><h2 id="embeddable" tabindex="-1">@Embeddable <a class="header-anchor" href="#embeddable" aria-label="Permalink to &quot;@Embeddable&quot;">​</a></h2><p>Annote une classe qui pourra représenter une clé composite</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Embeddable</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Connexion</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> String</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">login;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> LocalDateTime</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">dateHeureConnexion;</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Embeddable</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Connexion</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String login;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> LocalDateTime dateHeureConnexion;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span></code></pre></div><h2 id="embeddedid" tabindex="-1">@EmbeddedId <a class="header-anchor" href="#embeddedid" aria-label="Permalink to &quot;@EmbeddedId&quot;">​</a></h2><p>Définit un id dont le type est une classe annotée <code>@Embeddable</code></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">NotificationConnexion</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">EmbeddedId</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Connexion</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">connexion;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> String</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">message;</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NotificationConnexion</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">EmbeddedId</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Connexion connexion;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String message;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h2 id="generatedvalue" tabindex="-1">@GeneratedValue <a class="header-anchor" href="#generatedvalue" aria-label="Permalink to &quot;@GeneratedValue&quot;">​</a></h2><p>Demande à JPA de choisir une valeur unique pour chaque enregistrement. Il est possible de préciser une stratégie de génération de l’id grâce à un attribut <code>strategy</code>.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">GeneratedValue</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">strategy</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">GenerationType.IDENTITY)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">GeneratedValue</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">strategy</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">GenerationType.IDENTITY)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Long id;</span></span></code></pre></div><p><code>strategy=GenerationType.IDENTITY</code> : utilise une identité propre au SGBD (auto_increment de MySQL, séquence d&#39;Oracle) <code>strategy=GenerationType.SEQUENCE</code> : La génération de la clé primaire se base sur une séquence <code>strategy=GenerationType.TABLE</code> : La génération de la clé primaire utilise des valeurs stockées dans une table qui se nomme par défaut hibernate_sequences <code>strategy=GenerationType.AUTO</code> (valeur par défaut) : laisse Hibernate choisir la stratégie de génération d’id la plus adéquate</p><h2 id="sequencegenerator" tabindex="-1">@SequenceGenerator <a class="header-anchor" href="#sequencegenerator" aria-label="Permalink to &quot;@SequenceGenerator&quot;">​</a></h2><p>Déclare la séquence que JPA devra utiliser pour attribuer un id à une nouvelle instance</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">GeneratedValue</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">strategy</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">GenerationType.SEQUENCE, </span><span style="color:#6CB6FF;">generator</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;utilisateur_sequence&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">SequenceGenerator</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;utilisateur_sequence&quot;</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">GeneratedValue</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">strategy</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">GenerationType.SEQUENCE, </span><span style="color:#005CC5;">generator</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;utilisateur_sequence&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">SequenceGenerator</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;utilisateur_sequence&quot;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Long id;</span></span></code></pre></div><h2 id="tablegenerator" tabindex="-1">@TableGenerator <a class="header-anchor" href="#tablegenerator" aria-label="Permalink to &quot;@TableGenerator&quot;">​</a></h2><p>Déclare la table que JPA devra utiliser pour attribuer un id à une nouvelle instance</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">GeneratedValue</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">strategy</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">GenerationType.TABLE, </span><span style="color:#6CB6FF;">generator</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;utilisateur_id_broker&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">TableGenerator</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;utilisateur_id_broker&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">valueColumnName</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;next_id&quot;</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">GeneratedValue</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">strategy</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">GenerationType.TABLE, </span><span style="color:#005CC5;">generator</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;utilisateur_id_broker&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">TableGenerator</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;utilisateur_id_broker&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">valueColumnName</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;next_id&quot;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Long id;</span></span></code></pre></div><h2 id="genericgenerator" tabindex="-1">@GenericGenerator <a class="header-anchor" href="#genericgenerator" aria-label="Permalink to &quot;@GenericGenerator&quot;">​</a></h2><p>Sollicite une classe qui implémente l’interface IdentifierGenerator pour choisir un id unique :</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">GeneratedValue</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">generator</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;enquete_id_generator&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">GenericGenerator</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;enquete_id_generator&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#6CB6FF;">strategy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;fr.clelia.fx.enquetes.util.EnqueteIdGenerator&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">GeneratedValue</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">generator</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;enquete_id_generator&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">GenericGenerator</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;enquete_id_generator&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">strategy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;fr.clelia.fx.enquetes.util.EnqueteIdGenerator&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Long id;</span></span></code></pre></div><p><img src="`+p+`" alt="generic_generator"></p><h2 id="column" tabindex="-1">@Column <a class="header-anchor" href="#column" aria-label="Permalink to &quot;@Column&quot;">​</a></h2><p>Détaille la manière de créer la colonne en base Les principaux attributs de l&#39;annotation <code>@Column</code> sont :</p><ul><li><code>name</code> : nom de la colonne dans la table associée</li><li><code>nullable</code> : permet d&#39;autoriser ou d&#39;interdire null dans la colonne, pour autoriser null : <code>nullable=true - unique</code> : ajoute une contrainte d&#39;unicité sur la colonne</li><li><code>length</code> : précise la longueur de la colonne (pour les attributs de type String), par défaut : <code>255</code></li><li><code>updatable</code> : permet d’autoriser ou d’interdire la mise à jour de la colonne</li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Column</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">unique</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">nullable</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">false</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">length</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">150</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> String</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">nom;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Column</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">unique</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nullable</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">150</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String nom;</span></span></code></pre></div><h2 id="basic" tabindex="-1">@Basic <a class="header-anchor" href="#basic" aria-label="Permalink to &quot;@Basic&quot;">​</a></h2><p>Déclare de la manière la plus simple une correspondance entre un attribut Java et une colonne éponyme dans la table associée. Cette annotation est rarement utilisée aujourd’hui. C’est la pièce de musée de ce mémento.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Basic</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> String</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">libelle;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Basic</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String libelle;</span></span></code></pre></div><h2 id="lob" tabindex="-1">@Lob <a class="header-anchor" href="#lob" aria-label="Permalink to &quot;@Lob&quot;">​</a></h2><p>Indique que la colonne doit contenir un texte long (permet aussi de stocker des données binaires)</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Lob</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> String</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">scriptDAccroche;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Lob</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String scriptDAccroche;</span></span></code></pre></div><h2 id="temporal" tabindex="-1">@Temporal <a class="header-anchor" href="#temporal" aria-label="Permalink to &quot;@Temporal&quot;">​</a></h2><p><code>@Temporal(TemporalType.DATE)</code> : crée dans la table une colonne de type date <code>@Temporal(TemporalType.TIME)</code> : crée dans la table une colonne de type time <code>@Temporal(TemporalType.TIMESTAMP)</code> : crée dans la table une colonne de type datetime Important :</p><ul><li>il est conseillé d’utiliser les classes LocalDate, LocalTime et LocalDateTime. En utilisant ces classes l’annotation Temporal n’a pas d’utilité</li><li>il ne faut pas utiliser la classe java.sql.Date dans les classes métier Sans préciser <code>@Temporal</code>, Hibernate ajoute une colonne datetime pour un attribut de type <code>java.util.Date</code></li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Temporal</span><span style="color:#ADBAC7;">(TemporalType.DATE)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Date</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">dateDInscription;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Temporal</span><span style="color:#24292E;">(TemporalType.DATE)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Date dateDInscription;</span></span></code></pre></div><h2 id="onetoone" tabindex="-1">@OneToOne <a class="header-anchor" href="#onetoone" aria-label="Permalink to &quot;@OneToOne&quot;">​</a></h2><p>Indique une bijection avec l&#39;autre classe. Entre les deux classes il y a deux associations dirigées (allant dans des directions oposées) avec une multiplicité 0..1 pour chaque association. Exemple : un utilisateur a un seul avatar. Un avatar correspond à un seul utilisateur</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Utilisateur</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">GeneratedValue</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span>
<span class="line"><span style="color:#768390;">// Autres attributs</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">OneToOne</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Avatar</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">avatar; }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Utilisateur</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">GeneratedValue</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Long id;</span></span>
<span class="line"><span style="color:#6A737D;">// Autres attributs</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">OneToOne</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Avatar avatar; }</span></span></code></pre></div><h2 id="manytoone" tabindex="-1">@ManyToOne <a class="header-anchor" href="#manytoone" aria-label="Permalink to &quot;@ManyToOne&quot;">​</a></h2><p>Indique que plusieurs objets de la classe vont être associés à un seul et même objet de l&#39;autre classe</p><p>Dans notre exemple plusieurs enquêtes font référence à un même thème.</p><p><img src="`+o+`" alt="many_to_one"></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">abstract</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Enquete</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">GeneratedValue</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">strategy</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">GenerationType.IDENTITY)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Column</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">unique</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">nullable</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">false</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">length</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">150</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> String</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">nom;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Date</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">dateDeLancement;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">float</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">prix;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">ManyToOne</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Theme</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">theme; }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Enquete</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">GeneratedValue</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">strategy</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">GenerationType.IDENTITY)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Long id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Column</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">unique</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">nullable</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">150</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String nom;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Date dateDeLancement;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> prix;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ManyToOne</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Theme theme; }</span></span></code></pre></div><p>En base, dans la table Enquete, une colonne theme_id sera ajoutée, c’est une clé étrangère vers la table Theme. En oubliant l’annotation <code>@ManyToOne</code> sur un attribut métier, on obtient l’erreur suivante : Caused by: org.hibernate.MappingException: Could not determine type for: fr.clelia.fx.enquetes.business.Theme, at table: Enquete, for columns: [org.hibernate.mapping.Column(theme)]</p><h2 id="onetomany" tabindex="-1">@OneToMany <a class="header-anchor" href="#onetomany" aria-label="Permalink to &quot;@OneToMany&quot;">​</a></h2><p>Indique qu&#39;un objet de la classe va être associé à plusieurs objets de l&#39;autre classe. Pour l’attribut <code>mappedBy</code>, on précise le nom de l’objet dans l’autre classe. Dans l’exemple de la page précédente: à un thème correspond une liste d’enquêtes. Une enquête est associée à un thème, il y a donc un attribut nommé theme dans la classe Enquete. C’est le nom de cet attribut Java que l’on écrit dans l’attribut <code>mappedBy</code> de l’annotation <code>OneToMany</code>:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Theme</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">Id</span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">GeneratedValue</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">private</span></span>
<span class="line"><span style="color:#ADBAC7;">    Long</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// Autres attributs</span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">OneToMany</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">mappedBy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;theme&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Enquete</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">enquetes;</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Theme</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Id</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">GeneratedValue</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">private</span></span>
<span class="line"><span style="color:#24292E;">    Long id;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Autres attributs</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;theme&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Enquete</span><span style="color:#24292E;">&gt; enquetes;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span></code></pre></div><p>En règle générale, dès qu’une classe comporte une liste d’objets métier, elle sera annotée <code>@OneToMany</code>. Idem pour un objet de type <code>Set</code>. Bien penser à préciser le type de récupération en utilisant l’attribut <code>fetch</code>, par défaut le fetch est <code>FetchType.LAZY.</code></p><p><strong>Exemple</strong>: si l’on souhaite récupérer d’emblée toutes les enquêtes d’un thème, on choisira le type de fetch <code>EAGER</code>:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">OneToMany</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">mappedBy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;theme&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">fetch</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">FetchType.EAGER)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Enquete</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">enquetes;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;theme&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">fetch</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">FetchType.EAGER)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Enquete</span><span style="color:#24292E;">&gt; enquetes;</span></span></code></pre></div><p>En essayant de récupérer les enquêtes sans avoir au préalable utilisé le fetch type <code>EAGER</code> on obtient l’exception suivante: Caused by: org.hibernate.LazyInitializationException: failed to lazily initialize a collection of role: fr.clelia.fx.enquetes.business.Theme.enquetes, could not initialize proxy - no Session</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>A noter: on ne peut pas avoir plus d’un <code>FetchType à EAGER</code> par classe. En utilisant deux fois le <code>FecthType EAGER</code> dans une même classe on obtient l’exception suivante: Caused by: org.hibernate.loader.MultipleBagFetchException: cannot simultaneously fetch multiple bags</p></div><p>Notion de cascade :</p><ul><li><p>On ajoute en mémoire un objet de type Enquete et on lui associe un ensemble de questions :</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">Enquete</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">enquete1</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">Enquete</span><span style="color:#ADBAC7;">(“Enquete </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">”, theme1);</span></span>
<span class="line"><span style="color:#ADBAC7;">enquete1.</span><span style="color:#DCBDFB;">getQuestions</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">add</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">Question</span><span style="color:#ADBAC7;">(“Question </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">”, enquete1));</span></span>
<span class="line"><span style="color:#ADBAC7;">enquete1.</span><span style="color:#DCBDFB;">getQuestions</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">add</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">Question</span><span style="color:#ADBAC7;">(“Question </span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">”, enquete1));</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Enquete enquete1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Enquete</span><span style="color:#24292E;">(“Enquete </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">”, theme1);</span></span>
<span class="line"><span style="color:#24292E;">enquete1.</span><span style="color:#6F42C1;">getQuestions</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Question</span><span style="color:#24292E;">(“Question </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">”, enquete1));</span></span>
<span class="line"><span style="color:#24292E;">enquete1.</span><span style="color:#6F42C1;">getQuestions</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Question</span><span style="color:#24292E;">(“Question </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">”, enquete1));</span></span></code></pre></div><p>Pour qu’Hibernate enregistre l’enquete en base ainsi que toutes ses questions, il faut définir la liste de questions comme suit :</p></li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">OneToMany</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">mappedBy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;enquete&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">cascade</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> CascadeType.PERSIST)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Question</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">questions;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;enquete&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">cascade</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CascadeType.PERSIST)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Question</span><span style="color:#24292E;">&gt; questions;</span></span></code></pre></div><ul><li>Pour que les objets questions soit mis à jour en base (lorsqu’ils évoluent en mémoire), il faut utiliser la valeur <code>CascadeType.MERGE</code></li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">OneToMany</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">mappedBy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;enquete&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">cascade</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> CascadeType.MERGE)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Question</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">questions;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;enquete&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">cascade</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CascadeType.MERGE)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Question</span><span style="color:#24292E;">&gt; questions;</span></span></code></pre></div><ul><li>Pour effacer automatiquement tous les questions associées à une enquête qui doit être effacée, l’attribut cascade avec la valeur <code>CascadeType.REMOVE</code> doit être précisé:</li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">OneToMany</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">mappedBy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;enquete&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">cascade</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> CascadeType.REMOVE)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Question</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">enquetes;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;enquete&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">cascade</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CascadeType.REMOVE)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Question</span><span style="color:#24292E;">&gt; enquetes;</span></span></code></pre></div><ul><li>Pour effacer automatiquement tous les questions associées à une enquête qui doit être effacée et les détacher de l’entity manager, l’attribut cascade avec la valeur <code>CascadeType.DETACH</code> doit être précisé:</li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">OneToMany</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">mappedBy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;enquete&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">cascade</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> CascadeType.DETACH)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Question</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">enquetes;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;enquete&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">cascade</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CascadeType.DETACH)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Question</span><span style="color:#24292E;">&gt; enquetes;</span></span></code></pre></div><ul><li>Pour garantir toutes les opérations présentées ci-dessus, l’attribut cascade doit avoir la valeur <code>CascadeType.ALL</code></li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">OneToMany</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">mappedBy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;enquete&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">cascade</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> CascadeType.ALL)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Question</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">questions;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">OneToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;enquete&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">cascade</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CascadeType.ALL)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Question</span><span style="color:#24292E;">&gt; questions;</span></span></code></pre></div><h2 id="manytomany" tabindex="-1">@ManyToMany <a class="header-anchor" href="#manytomany" aria-label="Permalink to &quot;@ManyToMany&quot;">​</a></h2><p>Indique une liste dans chaque classe. Entre les deux classes il y a deux associations dirigées (allant dans des directions oposées) avec une multiplicité 0..* pour chaque association.</p><p>Exemple : à une enquête correspond plusieurs sites internet. Un site internet est utilisé par plusieurs enquête. En base une table de mapping sera créée.</p><p>L’attribut <code>mappedBy</code> doit figurer uniquement sur une des deux annotations sinon l’exception <code>AnnotationException</code> est levée avec le message suivant: Illegal use of mappedBy on both sides of the relationship On choisit de mettre l’attribut <code>mappedBy</code> sur la classe satellite, dans ce projet la classe centrale est Enquete, les classes autour sont les classes satellites.</p><p>Dans l’exemple ci-dessous, l’enregistrement d’un objet de type Enquete “alimentera” bien la table de mapping car dans la classe SitePartenaire on a le code suivant:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">ManyToMany</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">mappedBy</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;sitesPartenaires&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Set</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">EnqueteInternet</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">enquetes;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ManyToMany</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">mappedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;sitesPartenaires&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Set&lt;</span><span style="color:#D73A49;">EnqueteInternet</span><span style="color:#24292E;">&gt; enquetes;</span></span></code></pre></div><p>Hibernate va remplir la liste sitesPartenaires avec ce qui a été choisi dans la liste multiple (select)</p><p><img src="`+t+`" alt="enquete_select"></p><h2 id="joincolumn" tabindex="-1">@JoinColumn <a class="header-anchor" href="#joincolumn" aria-label="Permalink to &quot;@JoinColumn&quot;">​</a></h2><p>Redéfinit la colonne sur laquelle il existe une contrainte de clé étrangère</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">ManyToOne</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">JoinColumn</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;idEnquete&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Enquete</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">enquete;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ManyToOne</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">JoinColumn</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;idEnquete&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Enquete enquete;</span></span></code></pre></div><h2 id="jointable" tabindex="-1">@JoinTable <a class="header-anchor" href="#jointable" aria-label="Permalink to &quot;@JoinTable&quot;">​</a></h2><p>Renomme la table de mapping (créée par un ManyToMany)</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">ManyToMany</span></span>
<span class="line"><span style="color:#ADBAC7;"> @</span><span style="color:#F47067;">JoinTable</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;enquetesInternet_SitesPartenaires&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">SiteParteneraire</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">sitesPartenaires;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ManyToMany</span></span>
<span class="line"><span style="color:#24292E;"> @</span><span style="color:#D73A49;">JoinTable</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;enquetesInternet_SitesPartenaires&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">SiteParteneraire</span><span style="color:#24292E;">&gt; sitesPartenaires;</span></span></code></pre></div><h2 id="inheritance" tabindex="-1">@Inheritance <a class="header-anchor" href="#inheritance" aria-label="Permalink to &quot;@Inheritance&quot;">​</a></h2><p>La classe Enquete est la classe mère des classes EnqueteTelephonique et EnqueteInternet. L’annotation <code>@Inheritance</code> permet de préciser la stratégie dans la manière de créer les tables liées à la notion d&#39;héritage</p><ul><li><code>strategy=InheritanceType.TABLE_PER_CLASS</code> : duplique les données pour éviter les opérations de jointure</li></ul><p><img src="`+c+'" alt="inheritance1"></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>NB : en choisissant cette stratégie d’héritage, la stratégie de génération de l’id dans la classe mère Enquete ne peut pas être IDENTITY. Il faudra choisir entre <code>AUTO</code>, <code>SEQUENCE</code> et <code>TABLE</code>.</p></div><ul><li><p><code>strategy=InheritanceType.SINGLE_TABLE</code> : classe mère et classes filles sont représentées par une table unique. La colonne <code>DTYPE</code> contiendra en toutes lettres le nom de la classe fille dont l’objet est une instance. Dans notre exemple : EnqueteTelephonique ou EnqueteInternet</p><p><img src="'+r+'" alt="inheritance2"></p></li></ul><p>La table Enquete va contenir des enregistrements correspondants à des enquêtes téléphoniques et des enregistrements correspondants à des enquêtes Internet</p><ul><li><code>strategy=InheritanceType.JOINED</code> : classe mère et classes filles sont représentées chacune par une table.</li></ul><p><img src="'+i+`" alt="inheritance3"></p><p>Dans la table représentant la classe mère, on trouvera les attributs communs à toutes les classes filles. Dans la table représentant la classe fille, on trouvera les informations propres à la classe fille. Si la stratégie n’est pas précisée, la stratégie <code>SINGLE_TABLE</code> est utilisée. L’annotation <code>@Inheritance</code> se place sur la classe mère.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Inheritance</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">strategy</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">InheritanceType.SINGLE_TABLE)</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">abstract</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Enquete</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Inheritance</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">strategy</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">InheritanceType.SINGLE_TABLE)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Enquete</span><span style="color:#24292E;"> {}</span></span></code></pre></div><p>La classe fille EnqueteTelephonique est déclare ainsi:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">EnqueteTelephonique</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">extends</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">Enquete</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">EnqueteTelephonique</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Enquete</span><span style="color:#24292E;"> {}</span></span></code></pre></div><h2 id="discriminatorvalue" tabindex="-1">@DiscriminatorValue <a class="header-anchor" href="#discriminatorvalue" aria-label="Permalink to &quot;@DiscriminatorValue&quot;">​</a></h2><p>Cette annotation sert uniquement dans les classes filles et avec la stratégie d’héritage <code>SINGLE_TABLE</code>. Elle permet de redéfinir la valeur qui sera ajoutée dans la colonne discriminante (par défaut nommée <code>DTYPE</code>)</p><h2 id="discriminatorcolumn" tabindex="-1">@DiscriminatorColumn <a class="header-anchor" href="#discriminatorcolumn" aria-label="Permalink to &quot;@DiscriminatorColumn&quot;">​</a></h2><p>Définit le nom de la colonne discriminante dans la table représentant la classe mère. En l’absence de cette annotation, la colonne discriminante se nomme <code>DTYPE</code>. Cette annotation sert uniquement lorsque la stratégie d’héritage est <code>SINGLE_TABLE</code>.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Inheritance</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">strategy</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">InheritanceType.SINGLE_TABLE)</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">DiscriminatorColumn</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;TypeEnquete&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">abstract</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Enquete</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Inheritance</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">strategy</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">InheritanceType.SINGLE_TABLE)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">DiscriminatorColumn</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;TypeEnquete&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Enquete</span><span style="color:#24292E;"> {}</span></span></code></pre></div><h2 id="mappedsuperclass" tabindex="-1">@MappedSuperClass <a class="header-anchor" href="#mappedsuperclass" aria-label="Permalink to &quot;@MappedSuperClass&quot;">​</a></h2><p>Cette annotation s’utilise sur une classe mère abstraite. Cette classe mère abstraite ne pourra pas être référencée dans des entités avec les relations <code>@ManyToOne</code>, <code>@ManyToMany</code> ou <code>@OneToOne</code>. Elle remplace l’annotation <code>@Entity</code>. Les attributs de la classe annotée <code>@MappedSuperClass</code> seront propagés dans les classes filles.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">MappedSuperClass</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">abstract</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Enquete</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">MappedSuperClass</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">abstract</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Enquete</span><span style="color:#24292E;"> {}</span></span></code></pre></div><h2 id="namedquery" tabindex="-1">@NamedQuery <a class="header-anchor" href="#namedquery" aria-label="Permalink to &quot;@NamedQuery&quot;">​</a></h2><p>Déclare une requête HQL qui sera accessible par toutes les classes du projet</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">NamedQuery</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;Joueur.findAll&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">query</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;SELECT j FROM Joueur j&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Joueur</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">NamedQuery</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Joueur.findAll&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">query</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;SELECT j FROM Joueur j&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Joueur</span><span style="color:#24292E;"> {}</span></span></code></pre></div><h2 id="cache" tabindex="-1">@Cache <a class="header-anchor" href="#cache" aria-label="Permalink to &quot;@Cache&quot;">​</a></h2><p>Hibernate met en cache des objets dans chaque session. Chaque session constitue un cache de premier niveau. L’annotation <code>@Cache</code> configure l’entité dans le cache de second niveau. Cette configuration utilise l’énumération <code>CacheConcurrencyStrategy</code> qui met à disposition cinq stratégies : <code>NONE</code>, <code>READ_ONLY</code>, <code>NONSTRICT_READ_WRITE</code>, <code>READ_WRITE</code> et <code>TRANSACTIONAL</code>.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Entity</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Cache</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">usage</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">CacheConcurrencyStrategy.READ_WRITE)</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Theme</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Entity</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Cache</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">usage</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">CacheConcurrencyStrategy.READ_WRITE)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Theme</span><span style="color:#24292E;"> {}</span></span></code></pre></div><h2 id="foreignkey" tabindex="-1">@ForeignKey <a class="header-anchor" href="#foreignkey" aria-label="Permalink to &quot;@ForeignKey&quot;">​</a></h2><p>La particularité de cette annotation vient du fait qu’elle ne peut annoter un élément Java comme une classe, une méthode ou un attribut car sa cible est définie comme suit :</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Target</span><span style="color:#ADBAC7;">({})</span></span>
<span class="line"><span style="color:#ADBAC7;"> @</span><span style="color:#F47067;">Retention</span><span style="color:#ADBAC7;">(RetentionPolicy.RUNTIME)</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> @</span><span style="color:#F47067;">interface</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">ForeignKey</span><span style="color:#ADBAC7;"> {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Target</span><span style="color:#24292E;">({})</span></span>
<span class="line"><span style="color:#24292E;"> @</span><span style="color:#D73A49;">Retention</span><span style="color:#24292E;">(RetentionPolicy.RUNTIME)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> @</span><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ForeignKey</span><span style="color:#24292E;"> {}</span></span></code></pre></div><p>De ce fait, elle peut seulement être utilisée dans le paramètre d’une annotation, exemple :</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">ManyToOne</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">JoinColumn</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">foreignKey</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">ForeignKey</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">name</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&quot;fk_theme&quot;</span><span style="color:#ADBAC7;">))</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> Theme</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">theme;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ManyToOne</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">JoinColumn</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">foreignKey</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">@</span><span style="color:#D73A49;">ForeignKey</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;fk_theme&quot;</span><span style="color:#24292E;">))</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Theme theme;</span></span></code></pre></div><h2 id="transient" tabindex="-1">@Transient <a class="header-anchor" href="#transient" aria-label="Permalink to &quot;@Transient&quot;">​</a></h2><p>Permet de définir un attribut dans la classe sans qu’une colonne soit ajoutée dans la table associée. Dans l’exemple ci-dessous Hibernate ne va pas créer une colonne prixTTC dans la table associée à l’entité JPA :</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Transient</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">float</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">prixTTC;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Transient</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> prixTTC;</span></span></code></pre></div><h2 id="fetch" tabindex="-1">@Fetch <a class="header-anchor" href="#fetch" aria-label="Permalink to &quot;@Fetch&quot;">​</a></h2><p>Demande à Hibernate d’alimenter automatiquement les listes d’objets. Il existe trois modes de récupération : <code>JOIN</code>, <code>SELECT</code> et <code>SUBSELECT</code></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Fetch</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> FetchMode.SELECT)</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">ManyToMany</span></span>
<span class="line"><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Question</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">questions;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Fetch</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> FetchMode.SELECT)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ManyToMany</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">Question</span><span style="color:#24292E;">&gt; questions;</span></span></code></pre></div>`,130),u=[d];function A(D,C,h,F,E,m){return a(),n("div",null,u)}const B=s(y,[["render",A]]);export{v as __pageData,B as default};
